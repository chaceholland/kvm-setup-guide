<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KVM Software Setup Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-links a {
            padding: 10px 20px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .nav-links a:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.5rem;
            margin: 25px 0 15px 0;
        }

        .section h4 {
            color: #333;
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .critical-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .hotkey {
            display: inline-block;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-family: monospace;
            font-weight: bold;
            margin: 0 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        table tr:hover {
            background: #f5f5f5;
        }

        .back-button {
            display: inline-block;
            margin: 30px 0;
            padding: 15px 30px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .back-button:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .screenshot {
            max-width: 100%;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin: 15px 0;
        }

        ul, ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíª KVM Software Setup Guide</h1>
            <p>Configure Better Display, InputLeap, and advanced automation for seamless multi-computer switching</p>
        </div>

        <div class="nav">
            <div class="nav-links">
                <a href="#better-display">üåô Better Display</a>
                <a href="#inputleap">‚å®Ô∏è InputLeap</a>
                <a href="#stream-deck">üéõÔ∏è Stream Deck</a>
                <a href="#usb-switch">üîå USB Switch</a>
                <a href="#testing">‚úÖ Testing</a>
                <a href="#troubleshooting">üîß Troubleshooting</a>
            </div>
        </div>

        <div class="content">
            <!-- OVERVIEW -->
            <div class="section">
                <h2>üìã Overview</h2>
                <p>Now that your hardware is connected, configure the software to enable seamless switching between your three computers (Personal Mac, Work Mac, HP Dock) and two monitors.</p>

                <div class="info-box">
                    <strong>What You'll Set Up:</strong>
                    <ul>
                        <li><strong>Better Display:</strong> DDC/CI control to switch monitor inputs with keyboard shortcuts</li>
                        <li><strong>InputLeap:</strong> Share one keyboard and mouse across all computers</li>
                        <li><strong>Stream Deck (Optional):</strong> One-button switching for power users</li>
                        <li><strong>eKL USB Switch (Optional):</strong> Automated USB device switching via RS232 serial control</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Important: Input Type Configuration</strong><br>
                    Each computer uses a different monitor input type:
                    <ul>
                        <li>üü¢ <strong>Personal Mac:</strong> HDMI (Cmd+1)</li>
                        <li>üü† <strong>Work Mac:</strong> DisplayPort (Cmd+2)</li>
                        <li>üü£ <strong>HP Dock:</strong> USB-C (Cmd+3)</li>
                    </ul>
                </div>
            </div>

            <!-- BETTER DISPLAY -->
            <div class="section" id="better-display">
                <h2>üåô Better Display Setup</h2>
                <p>Better Display uses DDC/CI (Display Data Channel Command Interface) to control your monitors via software, allowing you to switch inputs with keyboard shortcuts.</p>

                <h3>Step 1: Download and Install</h3>
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Download Better Display</strong>
                    <p>Visit <a href="https://github.com/waydabber/BetterDisplay" target="_blank">https://github.com/waydabber/BetterDisplay</a> and download the latest release.</p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Install the Application</strong>
                    <p>Open the downloaded DMG file and drag Better Display to your Applications folder.</p>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Launch Better Display</strong>
                    <p>Open Better Display from your Applications folder. It will appear in your menu bar.</p>
                </div>

                <h3>Step 2: Grant Permissions</h3>
                <div class="critical-box">
                    <strong>üîê Required Permissions</strong><br>
                    Better Display needs specific macOS permissions to control your monitors via DDC/CI.
                </div>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Accessibility Permission</strong>
                    <p>When prompted, grant Better Display <strong>Accessibility</strong> access:</p>
                    <ol>
                        <li>Open <strong>System Settings</strong> ‚Üí <strong>Privacy & Security</strong> ‚Üí <strong>Accessibility</strong></li>
                        <li>Click the <strong>+</strong> button or toggle Better Display ON</li>
                        <li>Confirm the change with your password</li>
                    </ol>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Screen Recording Permission (if prompted)</strong>
                    <p>Grant <strong>Screen Recording</strong> permission if requested for advanced features.</p>
                </div>

                <h3>Step 3: Verify Monitor Detection</h3>
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Check Menu Bar</strong>
                    <p>Click the Better Display icon in your menu bar. You should see both Samsung ViewFinity S65UC monitors listed.</p>
                </div>

                <div class="info-box">
                    <strong>Expected Display:</strong>
                    <ul>
                        <li>Samsung S65UC (LEFT)</li>
                        <li>Samsung S65UC (RIGHT)</li>
                    </ul>
                    If you don't see both monitors, check your connections and restart Better Display.
                </div>

                <h3>Step 4: Configure Input Source Hotkeys</h3>
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Open Better Display Preferences</strong>
                    <p>Press <span class="hotkey">Cmd+,</span> or click Better Display menu bar icon ‚Üí <strong>Preferences</strong></p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Navigate to Hotkeys</strong>
                    <p>In the preferences window, click the <strong>Keyboard</strong> or <strong>Hotkeys</strong> tab.</p>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Configure Input Source Shortcuts</strong>
                    <p>Find the <strong>"Input Source"</strong> or <strong>"DDC/CI Input"</strong> section and set up these hotkeys:</p>

                    <table>
                        <tr>
                            <th>Hotkey</th>
                            <th>Input Type</th>
                            <th>Computer</th>
                        </tr>
                        <tr>
                            <td><span class="hotkey">Cmd+1</span></td>
                            <td>HDMI</td>
                            <td>üü¢ Personal Mac</td>
                        </tr>
                        <tr>
                            <td><span class="hotkey">Cmd+2</span></td>
                            <td>DisplayPort</td>
                            <td>üü† Work Mac</td>
                        </tr>
                        <tr>
                            <td><span class="hotkey">Cmd+3</span></td>
                            <td>USB-C</td>
                            <td>üü£ HP Dock</td>
                        </tr>
                    </table>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Apply to All Monitors</strong>
                    <p>Make sure the hotkeys are configured to switch <strong>ALL displays simultaneously</strong>, not just one monitor.</p>
                </div>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Important Configuration Notes:</strong>
                    <ul>
                        <li>Each hotkey should switch <strong>BOTH monitors</strong> to the same input type</li>
                        <li>Direct USB-C video connections are required (not through hubs) for DDC/CI to work</li>
                        <li>The Samsung ViewFinity S65UC supports DDC/CI on all input types</li>
                    </ul>
                </div>

                <h3>Step 5: Test Input Switching</h3>
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Test Each Hotkey</strong>
                    <p>With all three computers connected and powered on:</p>
                    <ul>
                        <li>Press <span class="hotkey">Cmd+1</span> - Both monitors should switch to HDMI (Personal Mac)</li>
                        <li>Press <span class="hotkey">Cmd+2</span> - Both monitors should switch to DisplayPort (Work Mac)</li>
                        <li>Press <span class="hotkey">Cmd+3</span> - Both monitors should switch to USB-C (HP Dock)</li>
                    </ul>
                </div>

                <div class="success-box">
                    <strong>‚úÖ Success Indicators:</strong>
                    <ul>
                        <li>Both monitors switch inputs simultaneously</li>
                        <li>Switching happens within 1-2 seconds</li>
                        <li>No flickering or errors</li>
                        <li>Display appears on the correct computer</li>
                    </ul>
                </div>
            </div>

            <!-- INPUTLEAP -->
            <div class="section" id="inputleap">
                <h2>‚å®Ô∏è InputLeap Setup</h2>
                <p>InputLeap allows you to share one keyboard and mouse across all three computers over your local network.</p>

                <h3>Overview</h3>
                <div class="info-box">
                    <strong>How InputLeap Works:</strong>
                    <ul>
                        <li>One computer acts as the <strong>Server</strong> (hosts the keyboard/mouse)</li>
                        <li>Other computers are <strong>Clients</strong> (receive input from server)</li>
                        <li>Move mouse to screen edge to switch between computers</li>
                        <li>Keyboard automatically follows the mouse</li>
                    </ul>
                    <strong>Recommended Configuration:</strong> Personal Mac = Server, Work Mac & HP Laptop = Clients
                </div>

                <h3>Step 1: Install InputLeap on All Computers</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Download InputLeap</strong>
                    <p>Visit <a href="https://github.com/input-leap/input-leap" target="_blank">https://github.com/input-leap/input-leap</a> and download the latest release for each operating system:</p>
                    <ul>
                        <li><strong>Personal Mac:</strong> macOS version (.dmg)</li>
                        <li><strong>Work Mac:</strong> macOS version (.dmg)</li>
                        <li><strong>HP Laptop:</strong> Windows version (.msi or .exe)</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Install on Each Computer</strong>
                    <p>Run the installer on each computer and follow the installation prompts.</p>
                </div>

                <h3>Step 2: Configure Network Connections</h3>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Network Requirement:</strong> All computers must be on the same local network. Use the UGREEN hubs to connect your MacBooks via Ethernet for best performance.
                </div>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Connect Ethernet Cables</strong>
                    <ul>
                        <li>Plug UGREEN Hub #1 into Personal Mac's USB-C port</li>
                        <li>Plug UGREEN Hub #2 into Work Mac's USB-C port</li>
                        <li>Connect Ethernet cables from both hubs to your router/switch</li>
                        <li>HP Laptop should be on the same network (Ethernet or Wi-Fi)</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Note IP Addresses</strong>
                    <p>Find each computer's local IP address:</p>
                    <ul>
                        <li><strong>macOS:</strong> System Settings ‚Üí Network ‚Üí (select connection) ‚Üí IP address shows as "192.168.x.x"</li>
                        <li><strong>Windows:</strong> Settings ‚Üí Network ‚Üí Properties ‚Üí IPv4 address</li>
                    </ul>
                </div>

                <h3>Step 3: Configure Server (Personal Mac)</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Launch InputLeap</strong>
                    <p>Open InputLeap on your Personal Mac.</p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Select Server Mode</strong>
                    <p>Choose <strong>"Server"</strong> mode in the InputLeap interface.</p>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Configure Screen Layout</strong>
                    <p>Click <strong>"Configure Server"</strong> and arrange the virtual screens to match your physical setup:</p>
                    <ul>
                        <li>Drag and drop screen icons to match your desk layout</li>
                        <li>Personal Mac (center or left)</li>
                        <li>Work Mac (adjacent to Personal)</li>
                        <li>HP Laptop (on the other side)</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Start the Server</strong>
                    <p>Click <strong>"Start"</strong> to begin hosting keyboard/mouse sharing.</p>
                </div>

                <h3>Step 4: Configure Clients (Work Mac & HP Laptop)</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Launch InputLeap on Work Mac</strong>
                    <p>Open InputLeap on Work Mac.</p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Select Client Mode</strong>
                    <p>Choose <strong>"Client"</strong> mode.</p>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Enter Server IP Address</strong>
                    <p>Enter the Personal Mac's IP address (from Step 2) in the <strong>"Server IP"</strong> field.</p>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Start the Client</strong>
                    <p>Click <strong>"Start"</strong> to connect to the server.</p>
                </div>

                <div class="step">
                    <span class="step-number">5</span>
                    <strong>Repeat for HP Laptop</strong>
                    <p>Follow the same steps on the HP Laptop to configure it as a client.</p>
                </div>

                <h3>Step 5: Test Keyboard/Mouse Sharing</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Test Mouse Movement</strong>
                    <p>Move your mouse to the edge of the Personal Mac screen. The cursor should appear on the adjacent computer's screen.</p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Test Keyboard</strong>
                    <p>When the cursor is on a different computer, type something to verify keyboard input works.</p>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Test Copy/Paste</strong>
                    <p>Copy text on one computer and paste it on another to verify clipboard sharing works.</p>
                </div>

                <div class="success-box">
                    <strong>‚úÖ InputLeap Working Correctly:</strong>
                    <ul>
                        <li>Mouse moves seamlessly between screens</li>
                        <li>Keyboard works on whichever computer has the cursor</li>
                        <li>Clipboard syncs between computers</li>
                        <li>No lag or connection issues</li>
                    </ul>
                </div>
            </div>

            <!-- STREAM DECK (OPTIONAL) -->
            <div class="section" id="stream-deck">
                <h2>üéõÔ∏è Stream Deck Integration (Optional)</h2>
                <p>If you have an Elgato Stream Deck, you can create one-button shortcuts to switch computers instantly.</p>

                <div class="info-box">
                    <strong>What Stream Deck Can Do:</strong>
                    <ul>
                        <li>Single button press switches monitor inputs (via Better Display)</li>
                        <li>Can trigger USB switch automation (advanced)</li>
                        <li>Visual feedback showing which computer is active</li>
                    </ul>
                </div>

                <h3>Stream Deck Setup</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Install Stream Deck Software</strong>
                    <p>Download and install the Stream Deck app from <a href="https://www.elgato.com/stream-deck" target="_blank">Elgato's website</a>.</p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Create Hotkey Buttons</strong>
                    <p>Add <strong>"Hotkey"</strong> actions to three buttons:</p>
                    <ul>
                        <li><strong>Button 1:</strong> "Personal Mac" - Sends <span class="hotkey">Cmd+1</span></li>
                        <li><strong>Button 2:</strong> "Work Mac" - Sends <span class="hotkey">Cmd+2</span></li>
                        <li><strong>Button 3:</strong> "HP Dock" - Sends <span class="hotkey">Cmd+3</span></li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Customize Button Icons</strong>
                    <p>Add custom icons or labels to make each button easily identifiable (üü¢ Personal, üü† Work, üü£ HP).</p>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Test Buttons</strong>
                    <p>Press each Stream Deck button to verify it switches both monitors correctly.</p>
                </div>
            </div>

            <!-- USB SWITCH -->
            <div class="section" id="usb-switch">
                <h2>üîå eKL USB Switch Setup (Optional)</h2>
                <p>The eKL USB Switch allows you to share USB peripherals (webcam, microphone, USB drives, etc.) across all three computers with automated switching via RS232 serial control.</p>

                <div class="info-box">
                    <strong>What the USB Switch Does:</strong>
                    <ul>
                        <li>Share USB devices across all three computers</li>
                        <li>Switch USB devices automatically when changing monitors</li>
                        <li>Control via RS232 serial commands</li>
                        <li>Integrate with Stream Deck for one-button switching</li>
                    </ul>
                </div>

                <h3>Overview</h3>
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Important:</strong> This setup requires an eKL USB switch with RS232 serial control support. The switch connects to your computer via a USB-to-RS232 adapter.
                </div>

                <h3>Step 1: Hardware Connection</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Connect the USB Switch</strong>
                    <ul>
                        <li>Connect USB peripherals (webcam, mic, etc.) to the eKL USB switch's USB ports</li>
                        <li>Connect USB output cables from the switch to each computer:
                            <ul>
                                <li>Port 1 ‚Üí Personal Mac</li>
                                <li>Port 2 ‚Üí Work Mac</li>
                                <li>Port 3 ‚Üí HP Dock</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Connect RS232 Serial Cable</strong>
                    <ul>
                        <li>Connect the RS232 cable from the eKL switch to a USB-to-RS232 adapter</li>
                        <li>Plug the USB-to-RS232 adapter into your Personal Mac (control computer)</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Power On the Switch</strong>
                    <p>Connect the power adapter to the eKL switch and verify the LED indicators light up.</p>
                </div>

                <h3>Step 2: Find the Serial Port</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Identify Serial Port Device (macOS)</strong>
                    <p>Open Terminal and run:</p>
                    <div class="code-block">ls /dev/tty.*</div>
                    <p>Look for a device like <code>/dev/tty.usbserial-XXXXXXXX</code> or <code>/dev/tty.SLAB_USBtoUART</code></p>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Note the Device Path</strong>
                    <p>Save this path - you'll need it for controlling the switch. Example: <code>/dev/tty.usbserial-14210</code></p>
                </div>

                <h3>Step 3: Manual Control via Terminal</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Test Serial Communication</strong>
                    <p>Most eKL switches use simple serial commands. The exact format depends on your model, but common formats are:</p>
                    <div class="code-block"># Switch to Port 1 (Personal Mac)
echo -e "\x01" > /dev/tty.usbserial-XXXXXXXX

# Switch to Port 2 (Work Mac)
echo -e "\x02" > /dev/tty.usbserial-XXXXXXXX

# Switch to Port 3 (HP Dock)
echo -e "\x03" > /dev/tty.usbserial-XXXXXXXX</div>
                </div>

                <div class="info-box">
                    <strong>Note:</strong> Serial command format varies by eKL model. Common formats include:
                    <ul>
                        <li>Hex bytes: <code>\x01</code>, <code>\x02</code>, <code>\x03</code></li>
                        <li>Text commands: <code>sw i01</code>, <code>sw i02</code>, <code>sw i03</code></li>
                        <li>Number commands: <code>1</code>, <code>2</code>, <code>3</code></li>
                    </ul>
                    Check your eKL switch manual for the exact command format.
                </div>

                <h3>Step 4: Create Control Scripts</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Create Helper Script</strong>
                    <p>Save this as <code>~/switch-usb.sh</code>:</p>
                    <div class="code-block">#!/bin/bash
# USB Switch Control Script
# Usage: ./switch-usb.sh [1|2|3]

PORT=$1
DEVICE="/dev/tty.usbserial-XXXXXXXX"  # Update with your device path

if [ -z "$PORT" ]; then
    echo "Usage: $0 [1|2|3]"
    echo "  1 = Personal Mac"
    echo "  2 = Work Mac"
    echo "  3 = HP Dock"
    exit 1
fi

case $PORT in
    1)
        echo -e "\x01" > $DEVICE
        echo "Switched USB to Personal Mac"
        ;;
    2)
        echo -e "\x02" > $DEVICE
        echo "Switched USB to Work Mac"
        ;;
    3)
        echo -e "\x03" > $DEVICE
        echo "Switched USB to HP Dock"
        ;;
    *)
        echo "Invalid port: $PORT"
        exit 1
        ;;
esac</div>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Make Script Executable</strong>
                    <div class="code-block">chmod +x ~/switch-usb.sh</div>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Test the Script</strong>
                    <div class="code-block">~/switch-usb.sh 1  # Switch to Personal Mac
~/switch-usb.sh 2  # Switch to Work Mac
~/switch-usb.sh 3  # Switch to HP Dock</div>
                </div>

                <h3>Step 5: Stream Deck Integration</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Add System Command Actions</strong>
                    <p>In Stream Deck software, enhance your existing computer-switching buttons:</p>
                    <ul>
                        <li><strong>Personal Mac button:</strong> Add "System: Open" action with command <code>/Users/yourusername/switch-usb.sh 1</code></li>
                        <li><strong>Work Mac button:</strong> Add "System: Open" action with command <code>/Users/yourusername/switch-usb.sh 2</code></li>
                        <li><strong>HP Dock button:</strong> Add "System: Open" action with command <code>/Users/yourusername/switch-usb.sh 3</code></li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Configure Multi-Action</strong>
                    <p>For each Stream Deck button, create a Multi-Action that:</p>
                    <ol>
                        <li>Sends Better Display hotkey (Cmd+1, Cmd+2, or Cmd+3)</li>
                        <li>Runs the USB switch script (1, 2, or 3)</li>
                    </ol>
                    <p>This switches both monitors AND USB devices with one button press!</p>
                </div>

                <h3>Step 6: Better Display + USB Switching</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Create Combined Switching Scripts</strong>
                    <p>Save as <code>~/switch-to-personal.sh</code>:</p>
                    <div class="code-block">#!/bin/bash
# Switch everything to Personal Mac
osascript -e 'tell application "System Events" to keystroke "1" using command down'
sleep 0.5
~/switch-usb.sh 1</div>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Create Similar Scripts for Other Computers</strong>
                    <p><code>~/switch-to-work.sh</code>:</p>
                    <div class="code-block">#!/bin/bash
osascript -e 'tell application "System Events" to keystroke "2" using command down'
sleep 0.5
~/switch-usb.sh 2</div>
                    <p><code>~/switch-to-hp.sh</code>:</p>
                    <div class="code-block">#!/bin/bash
osascript -e 'tell application "System Events" to keystroke "3" using command down'
sleep 0.5
~/switch-usb.sh 3</div>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Make All Executable</strong>
                    <div class="code-block">chmod +x ~/switch-to-*.sh</div>
                </div>

                <h3>Step 7: Test USB Switching</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Test Manual Switching</strong>
                    <ul>
                        <li>Run <code>~/switch-usb.sh 1</code> - USB devices should switch to Personal Mac</li>
                        <li>Verify webcam/mic appear in Personal Mac's system</li>
                        <li>Test other ports (2, 3) similarly</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Test Combined Switching</strong>
                    <ul>
                        <li>Run <code>~/switch-to-personal.sh</code> - Both monitors AND USB devices switch</li>
                        <li>Verify everything switches together</li>
                        <li>Test delay (adjust <code>sleep</code> value if needed)</li>
                    </ul>
                </div>

                <div class="success-box">
                    <strong>‚úÖ USB Switch Working Correctly:</strong>
                    <ul>
                        <li>Serial commands successfully switch USB ports</li>
                        <li>USB devices appear on the correct computer after switching</li>
                        <li>Combined scripts switch monitors + USB together</li>
                        <li>Stream Deck buttons (if configured) work correctly</li>
                    </ul>
                </div>

                <h3>Advanced: Automatic Switching with Better Display</h3>

                <div class="info-box">
                    <strong>Pro Tip:</strong> You can configure Better Display to automatically run your USB switch scripts when changing inputs. Check Better Display's scripting/automation settings to run custom commands on input change.
                </div>

                <h3>Troubleshooting USB Switch</h3>

                <div class="step">
                    <strong>Problem: Serial Port Not Found</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Check USB-to-RS232 adapter is connected</li>
                        <li>Install driver for USB-to-RS232 adapter if needed (FTDI, Prolific, or Silicon Labs drivers)</li>
                        <li>Try different USB port</li>
                        <li>Run <code>ls /dev/tty.*</code> before and after plugging in adapter to identify the device</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: Switch Doesn't Respond to Commands</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Verify command format matches your eKL switch model</li>
                        <li>Check RS232 cable connections (TX/RX not reversed)</li>
                        <li>Try different baud rate if your switch requires specific settings</li>
                        <li>Use <code>screen</code> or <code>minicom</code> to test raw serial communication</li>
                        <li>Consult your eKL switch manual for exact command protocol</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: USB Devices Don't Appear After Switching</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Verify eKL switch has power</li>
                        <li>Check USB cables from switch to computers are connected</li>
                        <li>Try manually pressing the switch button to verify hardware works</li>
                        <li>Wait a few seconds for computer to detect USB devices</li>
                        <li>Some devices may need to be unplugged/replugged once</li>
                    </ul>
                </div>
            </div>

            <!-- TESTING -->
            <div class="section" id="testing">
                <h2>‚úÖ Complete System Testing</h2>
                <p>Verify everything works together seamlessly.</p>

                <h3>Test Checklist</h3>

                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Monitor Input Switching</strong>
                    <ul>
                        <li>Press <span class="hotkey">Cmd+1</span> - Both monitors show Personal Mac</li>
                        <li>Press <span class="hotkey">Cmd+2</span> - Both monitors show Work Mac</li>
                        <li>Press <span class="hotkey">Cmd+3</span> - Both monitors show HP Dock</li>
                        <li>All switches happen within 1-2 seconds</li>
                        <li>No errors or black screens</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Keyboard/Mouse Sharing</strong>
                    <ul>
                        <li>Mouse moves between all three computers</li>
                        <li>Keyboard works on each computer</li>
                        <li>Copy/paste works across computers</li>
                        <li>No lag or stuttering</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>EDID Emulator Function</strong>
                    <ul>
                        <li>Unplug a display cable - windows stay in place on that computer</li>
                        <li>Switch monitor inputs - windows don't rearrange</li>
                        <li>Reboot computer - display layout restores correctly</li>
                    </ul>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>BENFEI USB Power (Work Mac)</strong>
                    <ul>
                        <li>Verify USB power cable is connected to BENFEI adapters</li>
                        <li>Work Mac displays on both monitors via DisplayPort</li>
                        <li>No flickering or signal loss</li>
                    </ul>
                </div>

                <div class="success-box">
                    <strong>üéâ System Complete!</strong><br>
                    If all tests pass, your KVM setup is fully operational. You can now seamlessly work across all three computers with one keyboard, mouse, and monitor setup.
                </div>
            </div>

            <!-- TROUBLESHOOTING -->
            <div class="section" id="troubleshooting">
                <h2>üîß Troubleshooting</h2>

                <h3>Better Display Issues</h3>

                <div class="step">
                    <strong>Problem: Monitors Don't Switch Inputs</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Verify Accessibility permission is granted in System Settings</li>
                        <li>Check that you're using direct USB-C video connections (not through hubs)</li>
                        <li>Restart Better Display from the menu bar</li>
                        <li>Confirm monitors support DDC/CI (Samsung ViewFinity S65UC does)</li>
                        <li>Try manually switching inputs using monitor OSD to verify input type names</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: Only One Monitor Switches</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Check that hotkeys are configured for "All Displays" not just one</li>
                        <li>Verify both monitors appear in Better Display menu</li>
                        <li>Check USB-C connections are secure on both monitors</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: Hotkeys Don't Work</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Check for keyboard shortcut conflicts in System Settings ‚Üí Keyboard ‚Üí Shortcuts</li>
                        <li>Try different hotkey combinations</li>
                        <li>Restart Better Display</li>
                    </ul>
                </div>

                <h3>InputLeap Issues</h3>

                <div class="step">
                    <strong>Problem: Client Can't Connect to Server</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Verify all computers are on the same network</li>
                        <li>Check server IP address is correct</li>
                        <li>Disable firewall temporarily to test connectivity</li>
                        <li>Ping server from client to verify network connection</li>
                        <li>Restart InputLeap on both server and client</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: Mouse Lag or Stuttering</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Use Ethernet connections instead of Wi-Fi for MacBooks</li>
                        <li>Check network congestion</li>
                        <li>Close bandwidth-heavy applications</li>
                        <li>Reduce InputLeap quality settings if needed</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: Keyboard Doesn't Work on Client</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Verify InputLeap is running on both server and client</li>
                        <li>Check Accessibility permissions on both computers</li>
                        <li>Restart InputLeap services</li>
                    </ul>
                </div>

                <h3>Hardware Issues</h3>

                <div class="step">
                    <strong>Problem: Work Mac DisplayPort Not Working</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Check BENFEI USB power cable is connected and powered</li>
                        <li>Verify coupler connections are secure</li>
                        <li>Try different DisplayPort cable</li>
                        <li>Check BENFEI adapter LED (if present) shows power</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: HP Dock USB-C Not Working</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Verify both adapters (DP‚ÜíHDMI and HDMI‚ÜíUSB-C) are connected</li>
                        <li>Check all couplers are seated properly</li>
                        <li>Confirm HP Dock is outputting DisplayPort signal</li>
                        <li>Try different HDMI cable between adapters</li>
                    </ul>
                </div>

                <div class="step">
                    <strong>Problem: Windows Rearrange When Switching</strong>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Verify EDID emulators are inline in all connections</li>
                        <li>Check EDID emulator LED (if present) is on</li>
                        <li>Ensure EDID emulator is 1440p version (matches monitor resolution)</li>
                    </ul>
                </div>

                <h3>Getting Additional Help</h3>

                <div class="info-box">
                    <strong>Resources:</strong>
                    <ul>
                        <li><strong>Better Display:</strong> <a href="https://github.com/waydabber/BetterDisplay/discussions" target="_blank">GitHub Discussions</a></li>
                        <li><strong>InputLeap:</strong> <a href="https://github.com/input-leap/input-leap/issues" target="_blank">GitHub Issues</a></li>
                        <li><strong>Monitor Manual:</strong> Samsung ViewFinity S65UC user guide for DDC/CI settings</li>
                    </ul>
                </div>
            </div>

            <!-- BACK BUTTON -->
            <div style="text-align: center; margin-top: 50px;">
                <a href="index.html" class="back-button">‚Üê Back to Hardware Guide</a>
            </div>
        </div>
    </div>
</body>
</html>
